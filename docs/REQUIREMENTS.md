# タイマーアプリ 要件定義（正本）

> 本ドキュメントは本リポジトリにおける**要件の正本（Single Source of Truth）**です。
> `docs/TECHNICAL_SPECS.md` / `docs/UX_DESIGN_SPEC.md` / `docs/FEATURES.md` / `README.md` は参照用の派生ドキュメントとし、要件の最終判断は常に本書を優先します。

## 1. ドキュメント統制方針

- 要件・受け入れ基準・Phase定義の正本は `docs/REQUIREMENTS.md` に固定する。
- 関連ドキュメントは本書へのリンクと要約に限定し、矛盾が発生した場合は本書を優先する。
- 仕様変更PRでは、まず本書を更新し、その後に参照先ドキュメントを追従更新する。

## 2. プロダクト概要

- 名称: Timer App
- 目的: 個人の作業時間管理（基本タイマー、ポモドーロ、アジェンダ、複数タイマー）を支援する。
- 提供形態: ブラウザSPA

## 3. 技術スタック（`package.json`準拠）

### 3.1 コア
- React `^18.3.1`
- React DOM `^18.3.1`
- TypeScript `^5.9.2`
- Vite `^5.4.19`
- Zustand `^4.5.0`

### 3.2 UI / スタイリング
- shadcn/ui（Radix UI primitivesベース）
- Tailwind CSS `^3.4.0`
- tailwindcss-animate `^1.0.7`
- lucide-react `^0.469.0`

### 3.3 データ・補助
- Dexie `^4.0.11`（IndexedDB）
- date-fns `^3.6.0`
- sonner `^2.0.6`

## 4. UI方針（統一）

- UI実装は **shadcn/ui + Tailwind CSS** を標準とする。
- 新規UI実装でMUIを採用しない。
- 過去のMUI検討事項は「履歴情報」として別管理し、現行方針には含めない。

## 5. 機能要件

### 5.1 基本タイマー
- カウントダウン実行（開始/一時停止/停止/リセット）
- セッションラベル編集
- 履歴表示・削除・全削除

### 5.2 ポモドーロタイマー
- 作業/休憩フェーズ管理
- 開始/一時停止/停止/スキップ/リセット
- タスク名設定
- 設定値保存（作業時間・休憩時間など）

### 5.3 アジェンダタイマー
- アジェンダ表示とタイマー連携UI
- 作業単位の進行支援

### 5.4 複数タイマー
- 複数タイマーの一覧表示
- 個別タイマー操作
- 追加・削除などの管理UI

### 5.5 ログ閲覧
- ログビューア起動
- ログ検索/絞り込み/可視化（実装済み範囲）

## 6. Phase定義（実装実態ベースで再定義）

実装確認対象: `src/features/timer/containers/*`

- **Phase 1（完了）: 基本タイマー基盤**
  - 対象: `BasicTimer.tsx`
  - 状態: 完了
- **Phase 2（完了）: ポモドーロ機能**
  - 対象: `EnhancedPomodoroTimer.tsx`
  - 状態: 完了
- **Phase 3（完了）: アジェンダ/複数タイマーUI統合**
  - 対象: `NewAgendaTimer.tsx`, `MultiTimer.tsx`
  - 状態: 完了
- **Phase 4（進行中）: 非機能品質の定量改善**
  - 対象: パフォーマンス、アクセシビリティ、ログ品質の受け入れ基準達成
  - 状態: 進行中

## 7. 非機能要件（測定可能な受け入れ基準）

### 7.1 パフォーマンス
- 初回表示時、主要画面のLCPが **2.5秒以下**（ローカル計測、3回平均）
- タイマー稼働中のUI操作で、長時間タスク（Long Task > 50ms）が **1分あたり5件未満**
- 主要タブ切替操作の体感遅延を抑えるため、タブ切替から初回描画まで **200ms以下**（開発環境計測）

### 7.2 アクセシビリティ
- 主要画面でキーボード操作のみで「開始/停止/リセット/タブ移動」が完結できる
- フォーカス可視状態を保持し、操作対象にフォーカスリングが表示される
- テキストと背景のコントラスト比が **4.5:1以上**（通常テキスト）
- 自動検査（例: axe/Lighthouse）で重大違反（critical）が **0件**

### 7.3 ログ要件
- エラー発生時に `level`, `message`, `timestamp`, `category` を必須記録
- 主要ユーザー操作（開始/停止/タブ切替）を構造化ログで記録
- ログビューアでレベル絞り込みと全文検索が可能
- 再現手順のある不具合について、該当操作〜エラーまでのログ追跡率 **100%**

## 8. 受け入れ判定

- 機能要件（5章）を満たすこと
- Phase 4の非機能要件（7章）に対する測定結果をPRに添付すること
- 本書更新後に、参照ドキュメントが本書と矛盾しないこと
